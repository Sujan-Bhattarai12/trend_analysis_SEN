---
title: "Part2"
author: "Sujan Bhattarai"
format: html
editor: visual
---

s:

```{r}
#make new columns for months and days, add seasons to make it easy for  analysis and visualizations 
data <- trhup.phase %>% 
  mutate(phaseCorrectRainRatio= round(phaseCorrectRainRatio, digits=2),
         year= year(datetime),
         month= month(datetime, label = TRUE),
         day= day(datetime),
         period= if_else(hour(datetime)>5 & hour(datetime)< 19, "Day", "Night"),
         season = ifelse(
           month <= "Feb"  | month == "Dec", "winter",
           ifelse( month == "Mar" | month == "Apr" | month == "May", "pre_monsoon",
                   ifelse(month == "Oct" | month == "Nov", "post_monsoon", "monsoon")))) %>% 
  filter(year != 2019 & p.1 != 0)
```

You can add options to executable code like this

```{r}
##duplicate copy, the original data is often required in later stage
clone_copy <- data

##### summarized yearly data for exponential moving average
moving_average <- data %>% 
  group_by(year) %>% 
  summarize(temp= mean(t.1), rh= mean(rh.1), wind=mean(u.1), precip=sum(p.1),
            rain_ratio= mean(phaseCorrectRainRatio)) %>% ungroup()

moving_average$temp_ema        <- movavg(moving_average$temp,       n=5, type='e')
moving_average$rh_ema          <- movavg(moving_average$rh,         n=5, type='e')
moving_average$wind_ema        <- movavg(moving_average$wind,       n=5, type='e')
moving_average$precip_ema      <- movavg(moving_average$precip,     n=5, type='e')
moving_average$rain_ratio_ema  <- movavg(moving_average$rain_ratio, n=5, type='e')

###smoother precipitation curve as it shows cyclicity
acf(moving_average$precip_ema)
moving_average$smooth_precip <- moving_average$precip - moving_average$precip_ema
acf(moving_average$smooth_precip)

###trend test 
mk.test(moving_average$temp_ema)
sens.slope(moving_average$temp_ema)
pettitt.test(moving_average$temp_ema)

mk.test(moving_average$rh_ema)
sens.slope(moving_average$rh_ema)
pettitt.test(moving_average$rh_ema)

mk.test(moving_average$wind_ema)
sens.slope(moving_average$wind_ema)
pettitt.test(moving_average$wind_ema)

mk.test(moving_average$smooth_precip)
sens.slope(moving_average$smooth_precip)
pettitt.test(moving_average$smooth_precip)
acf(moving_average$precip_ema)

mk.test(moving_average$rain_ratio_ema)
sens.slope(moving_average$rain_ratio_ema)
pettitt.test(moving_average$rain_ratio_ema)
```
